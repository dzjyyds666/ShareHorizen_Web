<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>视频分片上传</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        input[type="file"] {
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
<h1>视频分片上传</h1>
<input type="file" id="videoFile" accept="video/*" />
<button id="uploadButton">上传视频</button>
<progress id="uploadProgress" value="0" max="100" style="display:none;"></progress>
<div id="status"></div>

<script>
    document.getElementById('uploadButton').addEventListener('click', async () => {
        const fileInput = document.getElementById('videoFile');
        const file = fileInput.files[0];
        const chunkSize = 100 * 1024 * 1024; // 10MB
        const totalChunks = Math.ceil(file.size / chunkSize);
        const statusDiv = document.getElementById('status');
        const progressBar = document.getElementById('uploadProgress');

        for (let chunkNumber = 0; chunkNumber < totalChunks; chunkNumber++) {
            const start = chunkNumber * chunkSize;
            const end = Math.min(start + chunkSize, file.size);
            const chunk = file.slice(start, end);

            const formData = new FormData();
            formData.append('file', chunk);
            formData.append('chunkNumber', chunkNumber + 1);
            formData.append('totalChunks', totalChunks);
            formData.append('name', file.name);

            progressBar.style.display = 'block';
            progressBar.value = ((chunkNumber + 1) / totalChunks) * 100;

            try {
                const response = await fetch('http://127.0.0.1:8889/admin/movieInfo/upload-chunk', {
                    method: 'POST',
                    body: formData
                });

                if (!response.ok) {
                    throw new Error('上传失败');
                }

                const result = await response.json();
                statusDiv.innerText = `第 ${chunkNumber + 1} 片上传成功: ${result.data}`;
            } catch (error) {
                statusDiv.innerText = `上传失败: ${error.message}`;
                return;
            }
        }



        statusDiv.innerText = '所有片上传成功！';
    });
</script>
</body>
</html>
